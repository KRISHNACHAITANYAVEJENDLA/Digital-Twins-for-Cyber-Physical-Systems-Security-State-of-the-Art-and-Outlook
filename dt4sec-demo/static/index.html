<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>DT4SEC Demo Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <h1>DT4SEC â€“ Digital Twin Security Demo</h1>
  <div>
    <canvas id="levelChart"></canvas>
  </div>
  <div>
    <h3>Latest Reading</h3>
    <pre id="latest">Loading...</pre>
    <h3>Recent Alerts</h3>
    <div id="alerts"></div>
  </div>
<script>
async function fetchJSON(url){ const r = await fetch(url); return r.json(); }
async function refresh(){
  const readings = await fetchJSON('/api/readings/recent?n=200').catch(()=>[]);
  const latest = await fetchJSON('/api/readings/latest').catch(()=>null);
  if(latest) document.getElementById('latest').textContent = JSON.stringify(latest, null, 2);
  const alerts = await fetchJSON('/api/alerts?n=20').catch(()=>[]);
  document.getElementById('alerts').innerHTML = alerts.map(a => `<div><b>${a.ts}</b> - ${a.alert} (score=${a.score.toFixed(3)})</div>`).join('');
  const labels = readings.map(r => new Date(r.ts).toLocaleTimeString());
  const level = readings.map(r => r.level);
  const inflow = readings.map(r => r.inflow);
  const outflow = readings.map(r => r.outflow);
  if(window._chart) window._chart.destroy();
  const ctx = document.getElementById('levelChart').getContext('2d');
  window._chart = new Chart(ctx, {
    type: 'line',
    data: { labels, datasets: [
      { label: 'Level', data: level },
      { label: 'Inflow', data: inflow },
      { label: 'Outflow', data: outflow }
    ]},
    options: { animation:false, responsive:true }
  });
}
setInterval(refresh, 2000);
refresh();
</script>
</body>
</html>
